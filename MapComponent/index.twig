<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin=""/>

<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.3.0/d3.min.js" integrity="sha512-NMhzM2RHzbCRO0s5VPaRC+2bW6nmNXimzC9p5sp2x19M+zzuSJ2T50dEQ7hpHkNjnX1mt8nQg1NNthwRZgsoIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<style>
*{box-sizing:border-box}body{margin:0}.map-wrapper{max-width:1080px;margin:0 auto;font-size:16px}select{appearance:none;background-color:#fff;border:1px solid #c4c4c4;border-radius:0;color:#222221;font-family:inherit;font-size:inherit;min-height:52px;width:100%;padding:.5rem}select+select{margin-left:1rem}.filter{display:flex;flex-wrap:no-wrap;width:100%;padding:0;justify-content:space-between}.filter .has-value{background-color:#e2382a;background-image:url(../assets/icons/chevron_dropdown-white-8e9b3105a4.svg);border-color:#e2382a;color:#fff;background-repeat:no-repeat;background-position:98%}select option{text-transform:capitalize}#map{height:80vh;width:100%}.div-marker>div{background-color:#e41a1c;padding:5px;width:25px;height:30px;border-radius:50% 30% 40% 30%;box-shadow:0 0 .4em #222221;mix-blend-mode:color;font-weight:700;text-align:center;color:#fff}.div-marker>div.church-icon{background-color:#ff7f00;padding:5px;width:25px;height:30px;border-radius:5%;box-shadow:0 0 .4em #222221;mix-blend-mode:color;border-radius:10% 10% 30% 30%}.div-marker div.church-icon::after{border:8px solid #ff7f00;border-color:#ff7f00 transparent transparent transparent}.div-marker div::after{position:absolute;bottom:-31.5px;left:4.5px;border:8px solid #e41a1c;content:" ";border-color:#e41a1c transparent transparent transparent;z-index:-1}.marker-cluster{width:auto;height:auto;border:none;background-color:transparent}.cluster-marker{width:30px;height:30px;border-radius:20% 30% 40% 50%;background-color:#5197f4;text-align:center;box-shadow:0 0 .8rem #5197f4;color:#fff;display:flex;align-items:center;justify-content:center}.leaflet-popup-content h2,.leaflet-popup-content p{margin:0!important}.leaflet-popup .leaflet-popup-content-wrapper{padding:1px;text-align:left;border-radius:5px 5px 5px 15px}.section-link{margin:.25rem 0;width:100%}.section-link-inner{width:100%;background-color:#e2382a;border-radius:5px;padding:.5rem .375rem;text-align:center}.btn-link{text-decoration:none;color:#fff!important}.legend-section{margin-top:10px}.legend-section>div{display:grid;grid-template-columns:repeat(auto-fill,300px);grid-gap:10px}.legend-item{display:flex;align-items:center;margin:0 .2rem}.legend-item img{height:30px;width:auto;margin-right:10px}.visualize-by{z-index:1000;background-color:#fff;bottom:10px;left:10px;border-radius:5px;padding:.5rem;position:absolute;box-shadow:0 0 .2rem #222}.visualize-by h6{margin:0!important;font-size:1rem;padding:0;font-size:16px!important}.d-none{display:none!important}.map-wrapper label{margin:0!important;font-size:16px;width:auto}.map-wrapper input[type=radio]{opacity:1;position:relative;margin:0;width:auto}.map-wrapper label::before{display:none}.card-section{padding:.5rem}a.card{color:#e2382a}.card{-ms-flex-align:start;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-box-pack:start;-ms-flex-pack:start;align-items:flex-start;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;justify-content:flex-start;padding:24px 40px;text-decoration:none;box-shadow:0 4px 14px 0 rgb(0 0 0 / 12%)}.card+.card{margin-top:20px}.card-count{margin-top:20px;margin-bottom:32px;font-size:1.2rem}.card-count span:first-child{font-weight:700}.card-count span:last-child{display:none}.card-location{color:#222221;margin:0 0 8px}.card-title{font-size:1.5rem;color:#222221;margin:12px 0 8px;padding-bottom:0;padding-top:0;text-decoration:none}.button--linkSmall{background-color:transparent;border:0;color:#e2382a;font-weight:700;letter-spacing:.125rem;padding:0 0 1px;position:relative;-webkit-transition:color .2s ease-out;transition:color .2s ease-out}.pagination{display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-filter:drop-shadow(0 4px 14px transparent);filter:drop-shadow(0 4px 14px rgba(0,0,0,0));justify-content:center;margin:20px auto}.pagination ul{display:flex;align-items:center;justify-content:center;list-style:none;margin:0;padding:0}.pagination ul li{margin-bottom:0;margin-top:0;padding-left:0;display:none;color:#222221;cursor:pointer;font-weight:700;margin:0 15px;opacity:.5}.pagination .ellipsis,.pagination ul li.indicator-visible{display:block}.pagination .current{color:#e2382a;display:-webkit-box;display:-ms-flexbox;display:flex;opacity:1}.pagination button{border:0;background-color:transparent;cursor:pointer}.pagination button>*{pointer-events:none}.pagination button:disabled svg{fill:#666;opacity:.5}.pagination button svg{fill:#e2382a;opacity:.5;width:32px;height:18px}.pagination-previous svg{transform:rotate(180deg)}@media screen and (max-width:480px){.legend-section>div{grid-template-columns:1fr 1fr;height:200px;overflow-y:auto}}
.section-link {margin: 0.25rem 0;width: 100%; }
.section-link-inner {width: 100%;background-color: #e2382a;border-radius: 5px;padding:0.5rem 0.375rem;text-align: center;}
.btn-link {text-decoration: none;color:#fff !important; }
.leaflet-control-layers-selector { width:auto !important; opacity:1};
</style> 
<script type="text/javascript">let data = {{ jsonData|json_encode }}</script>
<div class="container centerMaxWidthContainer" is="flynt-map-component">
    <h2 class="h1 preTitle">
        Unsere Einrichtungen und die unserer Mitgliedsorganisationen auf einen Blick
    </h2>
    <div class="map-wrapper">
        <div class="filter-container">
            <span class="service-instructions" _msthash="800670" _msttexthash="294996">Filtern Sie unsere Angebote</span>

            <ul class="filter" id="filter">
                <select name="servicecategory" id="service-select">
                    <option value="all" _msthash="559390" _msttexthash="257127">Alle Einrichtungstypen/Angebotsarten</option>
                </select>

                <select name="traeger" id="institution-select">
                    <option value="all" _msthash="559689" _msttexthash="198172">Alle Träger</option>
                </select>

                <select name="neighbourhood" class="" id="region-select">
                    <option value="all" _msthash="559988" _msttexthash="174642">Alle Regionen</option>
                </select>
            </ul>
        </div>

        <div id="map">
            <div class="visualize-by">
                <h6>Anzeigen nach</h6>
                <div class="">
                    <input type="radio" name="type" id="angebot" class="visual-type" checked>
                    <label for="angebot">Angebotsart</label>
                </div>
                <div class="">
                    <input type="radio" name="type" id="traeger" class="visual-type" >
                    <label for="traeger">Träger</label>
                </div>
            </div>
        </div>

        <div class="legend-section" id="">
            <div class="" id="angebot-legend"></div>
            <div class="d-none" id="traeger-legend"></div>
        </div>

        <div class="card-section" id="card-section">
            <div class="card-count" id="card-count">
                <span data-postamount="">96</span> 
                <span class="filterPosts">Einträge filtern</span>
                <span class="filteredPosts">Einträge gefunden</span>
            </div>
            <div class="card-items" id="card-items">

            </div>
        </div>

        <div class="pagination pagination-section">
            <button id="prev-btn" class="pagination-previous" disabled>
                <svg width="58" height="33" viewBox="0 0 58 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M41.5786 0.753299L40.1644 2.18409C39.8297 2.52272 39.8297 3.0718 40.1644 3.41051L51.2451 14.621H0.857142C0.383785 14.621 0 15.0093 0 15.4882V17.5116C0 17.9905 0.383785 18.3788 0.857142 18.3788H51.2451L40.1644 29.5894C39.8297 29.928 39.8297 30.4771 40.1644 30.8158L41.5786 32.2466C41.9134 32.5852 42.4561 32.5852 42.7909 32.2466L57.749 17.1132C58.0837 16.7745 58.0837 16.2254 57.749 15.8867L42.7908 0.753299C42.4561 0.41459 41.9134 0.41459 41.5786 0.753299Z"></path>
                </svg>
            </button>

            <ul>
                <li data-page="1" class="current indicator-visible">1</li>
                <li data-page="2" class="indicator-visible">2</li>
                <li data-page="3" class="indicator-visible">3</li>
                <li data-page="4">4</li>
                <li data-page="5">5</li>
                <li data-page="6">6</li>
                <li data-page="7">7</li>
                <li class="ellipsis">...</li>
                <li data-page="8" class="indicator-visible last-indicator">8</li>
            </ul>

            <button class="pagination-next" data-next="">
                <svg width="58" height="33" viewBox="0 0 58 33" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M41.5786 0.753299L40.1644 2.18409C39.8297 2.52272 39.8297 3.0718 40.1644 3.41051L51.2451 14.621H0.857142C0.383785 14.621 0 15.0093 0 15.4882V17.5116C0 17.9905 0.383785 18.3788 0.857142 18.3788H51.2451L40.1644 29.5894C39.8297 29.928 39.8297 30.4771 40.1644 30.8158L41.5786 32.2466C41.9134 32.5852 42.4561 32.5852 42.7909 32.2466L57.749 17.1132C58.0837 16.7745 58.0837 16.2254 57.749 15.8867L42.7908 0.753299C42.4561 0.41459 41.9134 0.41459 41.5786 0.753299Z"></path>
                </svg>
            </button>
        </div>
    </div>
</div>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

<script>
var servicesSelect = document.getElementById("service-select");
var regionsSelect = document.getElementById("region-select");
var institutionSelect = document.getElementById("institution-select");
let angebotLegend = document.getElementById("angebot-legend");
let traegerLegend = document.getElementById("traeger-legend");
var activeType = "angebot";

let servicesData = [];
let filterResult;
let angebotIcons = [
    'angebot_kita_ganztag', 'angebot_pflege', 'angebot_seniorinnen', 
    'angebot_mitgliedsorganisation', 'angebot_finanzielle_schwierigkeiten',
    'angebot_flucht_asyl', 'angebot_inklusion', 'angebot_jugend',
    'angebot_kultur', 'angebot_migration', 'angebot_lgbtqi', 
    'angebot_sucht', 'angebot_familie', 'angebot_frauen', 
    'angebot_geschaeftsstelle', 'angebot_straffaelligkeit',
    'angebot_psychische_beeintraechtigung', 'angebot_kinder', 'angebot_wohnungsnotfallhilfe',
    'angebot_engagement', 'angebot_beratung','angebot_freiwilligendienst', 'angebot_migration_integration',
    'angebot_rechts-sozialberatung'
];

let traegerIcons = [
    'traeger_awo_kreisverband_spree-wuhle', 
    'traeger_awo_kreisverband_mitte', 
    'traeger_awo_kreisverband_suedost', 
    'traeger_awo_kreisverband_berlin-nordwest', 
    'traeger_awo_kreisverband_suedwest',
    'traeger_awo_kreisverband_spandau', 
    'traeger_awo_kreisverband_treptow-köpenick', 

    // 'traeger_awo_pro:mensch_ggmbh', 
    // 'traeger_awo_gemeinnuetzige_pflegegesellschaft_mbh', 
    // 'traeger_liga_berlin_der_spitzenverbände_der_freien_wohlfahrtspflege', 
    
    ]

var map = L.map('map').setView([52.50697119418263, 13.400917053222658], 11);

// load a tile layer
L.tileLayer('https://{s}.tile.jawg.io/jawg-sunny/{z}/{x}/{y}{r}.png?access-token=URi8mB9dsRckbqXdBLh1emM3z9mabDqlnrdrHjSMV6wsZhLunQ03Nlkbr3FzDj2H', {
	attribution: '<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	minZoom: 0,
	maxZoom: 22,
	subdomains: 'abcd',
	accessToken: 'URi8mB9dsRckbqXdBLh1emM3z9mabDqlnrdrHjSMV6wsZhLunQ03Nlkbr3FzDj2H'
}).addTo(map);

// regions
let regions = L.geoJSON(null, {
    style:function(feature) {
        return {
            fillColor:feature.properties.color,
            fillOpacity:0.3,
            color:'#333',
            weight:0.5
        }
    }
});

fetch(`${data.dataUrl}/data/regions.geojson`)
.then(res => res.json())
.then(data => {
    regions.addData(data);

    map.fitBounds(regions.getBounds())
})
.catch(console.error)


// markers
let markerIcon = L.divIcon({
    className:'div-marker',
    html:'<div></div>'
});

let markerCluster = L.markerClusterGroup({
    showCoverageOnHover:false,
    iconCreateFunction: iconCreate
})
.addTo(map);
    
function iconCreate(cluster) {
    return L.divIcon({
        className:'marker-cluster',
        html: '<div class="cluster-marker"><b>' + cluster.getChildCount() + '</b><div>' 
    });
}

// 
let servicesObj = L.geoJSON(null, {

});

servicesObj.addTo(map);

// Layer control
let layerControl = L.control.layers({}, {
    'Regionen':regions,
    'Angebote':markerCluster
}, { collapsed:false }).addTo(map)


// handle input changes
let filterObj = {
    servicecategory:'all',
    servicelanguage:'all',
    neighbourhood:'all'
};

let filters = document.querySelectorAll(".filter > select");
console.log(filters);

filters.forEach(filter => {
    filter.onchange = function(e) {
        // get the id
        let { name, value } = e.target;
        filterObj[name] = value;

        let filter = [];
        Object.keys(filterObj).forEach(key => {
            if(filterObj[key] != 'all') {
                filter.push({
                    key,
                    value:filterObj[key]
                });
            }
        });

        value == 'all' ? toggleActiveClass(e.target) : toggleActiveClass(e.target, "add");

        // filter the results
        filterResult = filterServices(filter);
        console.log(filterResult);

        let markers = createMarkers(filterResult, activeType);

        // update the map
        markerCluster.clearLayers();
        markerCluster.addLayers(markers);

        paginator.setItems(filterResult).renderCards().updateCount();
    }
});

var visaulizeBy = document.querySelectorAll(".visual-type");
visaulizeBy.forEach(vBy => {
    vBy.addEventListener("click", function(e) {
        let { target: { name, id} } = e;

        console.log(id);
        activeType = id;

        let data = JSON.parse(JSON.stringify(filterResult || servicesData));
        let markers = createMarkers(data, id);

        // update the map
        markerCluster.clearLayers();
        markerCluster.addLayers(markers);

        // hide the leged section
        if(id == "angebot") {
            angebotLegend.classList.remove('d-none');
            traegerLegend.classList.add('d-none');
        } else {
            angebotLegend.classList.add('d-none');
            traegerLegend.classList.remove('d-none');
        }
    });

    
});

function handleSelectChange(e) {

}

function toggleActiveClass(element, action='remove') {
    if(action == "add") {
        element.classList.add('has-value');
    } else {
        element.classList.remove('has-value');
    }
    
}

// filter the data
function filterServices(filterItems) {
    let result = JSON.parse(JSON.stringify(servicesData));
    return result.filter(item => filterItems.every(fItem => item[fItem.key].includes(fItem.value)))
}

function onLoad(posts) {    
    let markers = createMarkers(posts);
    markerCluster.addLayers(markers);
}

function loadSelectValues(data) {
    let rCompose = compose(getUniqueValues, stringFilter, getValues)
    let sCompose = compose(getUniqueValues, stringFilter, trimMap, flattenValues, splitMap, getValues);

    let services = sCompose({items:data.terms[0], field:'name'})
    let regions = rCompose({items:data.terms[2], field:'name'});
    let institutions = sCompose({items:Object.values(data.posts), field:'traeger'});
    console.log(institutions);

    // update the  
    updateSelect(
        optionItems(optionItem)(services.sort())
    )(servicesSelect);

    updateSelect(
        optionItems(optionItem)(regions.sort())
    )(regionsSelect);

    updateSelect(
        optionItems(optionItem)(institutions.sort())
    )(institutionSelect);

    servicesData = JSON.parse(JSON.stringify(Object.values(data.posts)))

    onLoad(servicesData);
    paginator.setItems(servicesData).renderCards().updateCount();
}

function splitValues(item) {
    return item.split(",");
}

function flattenValues(items) {
    return items.flatMap(i => i);
}

// get the regions
function getValues({items, field}) {
    return items.map(item => item[field].trim())
}

function getUniqueValues(items) {
    return [... new Set(items)];
}

const splitMap = items => items.map(splitValues);
const trimMap = items => items.map(item => item.trim());
const stringFilter = items => items.filter(item => item);

const compose = (...fns) => x => fns.reduceRight((y, f) => f(y), x);

// update the select section
const updateSelect = (optionHtml) => elem => elem.innerHTML += optionHtml;
const optionItems = fn => x => x.map(fn);
function optionItem(item) {
    return `<option value="${item}">${item}</option>`
}

function createMarkers(data, type="angebot") {

    let markerArray = data.filter(item => item.laengengrad != "0" && item.laengengrad && item.servicecategory).map(item => {
        let popupContent = getPopupContent(item);
        let iconName;
        if(type == "angebot") {
            iconName = getIconName(item.servicecategory, type);
        } else {
            iconName = getIconName(item.traeger, 'traeger');
        }

        let icon = iconName ? getMarkerIcon(iconName, type) : markerIcon;
        let marker = L.marker([
            parseFloat(item.breitengrad), 
            parseFloat(item.laengengrad)
        ], 
        { icon:icon }
        ).bindPopup(popupContent);


        marker.on('mouseover', function(e) {
            marker.togglePopup();
        });

        return marker;

    });

    console.log(markerArray.length);
    return markerArray;
}

function getPopupContent(item) {
    return `<div>
        <h5 style="margin:0;">${item.post_title}</h5> 
        <p>${item.address}</p>
        <div class="popup-body">
            <div class="">
                <div><b>Telefonnummer</b></div>
                <div>${item.telephone}</div>
            </div>
            <div class="">
                <div><b>Angebote</b></div>
                <div>${item.servicecategory}</div>
            </div>

            <div class="">
                <div><b>Regionen</b></div>
                <div>${item.neighbourhood}</div>
            </div>

            <div class="">
                <div><b>Träger</b></div>
                <div>${item.traeger}</div>
            </div>

            <div class="section-link">
                <a href="${item.website}" class="btn-link">
                    <div class="section-link-inner">Website</div>
                </a>
            </div>
            
        </div>
    </div>`;
}

function getMarkerIcon(value, field) {
    return L.icon({
        iconUrl:getIconUrl(value, field),
        iconSize:[32, 32]
    });
}

// loadSelectValues(data);
function getIconName(value, field) {
    value = value.split(",")[0];

    let name = "";
    if(field == 'angebot') {
        name = value.replace(/\s/g, "_").toLowerCase().replace(/ä/g, "ae").replace("/", "_").replace("*", "");
        let iconName = `${field}_${name}`;

        if(angebotIcons.indexOf(iconName) == -1) {
            console.log(iconName);
        }

        return angebotIcons.indexOf(iconName) != -1 ? iconName : false;
    } else {
        name = value.trim().replace(/\s/g, "_").replace("_e.V.", "").replace(/ü/g, "ue").toLowerCase()
        let iconName = `${field}_${name}`;

        return traegerIcons.indexOf(iconName) != -1 ? iconName : 'traeger_mitgliedsorganisation_korporatives_mitglied';
    }

}

function getIconUrl(iconName, field) {
    // return iconName;
    return `${data.dataUrl}/${field}Icon/${iconName}.png`
}


function visaulizeBy() {
    
}

function updateLegend() {
    // update the legend item
    angebotLegend.innerHTML = data.terms[0].map(term => { 
        let t = "angebot_" + term.slug.replace("-", "_");

        return [term.name, t]
    }).map(item => legendItem(item[1], item[0], "angebot")).join("");

    let sCompose = compose(getUniqueValues, stringFilter, trimMap, flattenValues, splitMap, getValues);
    institutions = sCompose({items:Object.values(data.posts), field:'traeger'});

    traegerLegend.innerHTML = institutions.map(ins => {
        let iconName = ins.trim().replace(/\s/g, "_").replace("_e.V.", "").replace(/ü/g, "ue").toLowerCase();
        iconName = `traeger_${iconName}`;

        // if(traegerIcons.indexOf(iconName) != -1) {
        //     console.log(iconName);
        // }

        iconName = traegerIcons.indexOf(iconName) != -1 ? iconName : 'traeger_mitgliedsorganisation_korporatives_mitglied';

        return [ins, iconName]
    }).map(item => legendItem(item[1], item[0], "traeger")).join("");

}

function legendItem(iconName, category, field="angebot") {
    // let category;
    // if(field == 'angebot') {
    //     category = iconName.split("_").slice(1,).join("/");
    // } else {
    //     category = iconName.split("_").slice(1,).join("/");
    // }

    return `<div class="legend-item">
        <img src="${data.dataUrl}/${field}Icon/${iconName}.png" alt="">
        <div>
            ${category}
        </div>
    </div>`
}

updateLegend();

// pagination section
const Paginator = function(items) {
    this.items = items;
    this.currentPage = 0;
    this.itemsPerPage = 10;
    this.cardItems = document.getElementById("card-items");
    this.cardCount = document.getElementById("card-count");

    this.nextButton = document.querySelector("button.pagination-next");
    this.previousButton = document.querySelector("button.pagination-previous");
    this.listPages = document.querySelectorAll(".pagination ul li");
    this.currentPageItem = document.querySelector("li.current");

    this.setItems = function (items) {
        this.items = items;

        return this;
    }

    this.updateCount = function() {
        this.cardCount.innerHTML = `<span data-postamount="">${this.items.length}</span> 
        <span class="filterPosts">Einträge filtern</span>
        <span class="filteredPosts">Einträge gefunden</span>`;

        return this;
    }

    this.renderCards = function() {
        let start = this.currentPage * this.itemsPerPage;
        let end = start + this.itemsPerPage;

        
        let items = this.items.slice(start, end);
        console.log(items);

        let cards = items.map(item => {
            let services = item.servicecategory.split(",").filter(service => service).map(service => `<span>${service}</span>,`).join("");

            return `<a href="${item.guid}" class="card boxRadius boxShadow">
                <div>${services}</div>
            <div class="card-category"></div>
            <div class="card-title h2">${item.post_title}</div>
                    <div class="card-location">Wo? ${item.address}</div>
                <div class="button button--linkSmall">mehr erfahren</div>
          </a>`;

        }).join("");

        this.cardItems.innerHTML = cards;
        return this;
    }

    this.firePageListeners = function() {
        this.previousButton.addEventListener("click", (e) => {
            this.gotoPrevious();
        });

        this.nextButton.addEventListener("click", (e) => {
            this.gotoNext();
        });

        // list Items
        this.listPages.forEach(listPage => {
            listPage.addEventListener("click", (e) => {
                this.currentPageItem.classList.remove("current");

                let { target } = e;
                let  { dataset: { page } } = target;
                
                target.classList.add("current");
                this.currentPageItem = target;

                this.gotoPage(page);
            });

        });
    }

    this.updateActivePageItem = function() {
        this.listPages.forEach(pageItem => {
            let page = pageItem.getAttribute("data-page");

            if(page == this.currentPage) {
                pageItem.classList.add("current");
                this.currentPageItem = pageItem;
                return pageItem;
            }

            pageItem.classList.remove("current");
            return pageItem;
        });
    }

    this.toggleBtnDisabledState = function() {
        if(this.activePage == 0) {
            this.previousButton.disabled = true;
        } else {
            this.previousButton.disabled = false;
        }

        if(this.currentPage == this.items.length -1) {
            this.nextButton.disabled = true;
        } else {
            this.nextButton.disabled = false;
        }
    }
   
    this.gotoNext = function() {
        this.currentPage += 1;
        this.renderCards();
        this.updateActivePageItem();

        this.toggleBtnDisabledState();

        return this;
    }

    this.gotoPrevious = function() {
        this.currentPage -= 1;
        this.renderCards();
        this.updateActivePageItem();

        this.toggleBtnDisabledState();

        return this;
    }

    this.gotoPage = function(page) {
        this.currentPage = page;

        this.renderCards();
        return this;
    }
}

let paginator = new Paginator([]);
paginator.firePageListeners();

loadSelectValues(data);
// markerIcon (first category), multiple filter, 
// traeger
</script>


